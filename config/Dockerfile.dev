# ----------- Development Dockerfile -----------
FROM node:20-alpine
# Install system dependencies
RUN apk add --no-cache git dumb-init && \
    addgroup -g 1001 -S nodejs && \
    adduser -S nextjs -u 1001 -G nodejs
WORKDIR /app
RUN chown nextjs:nodejs /app
USER nextjs
# Copy package files and install dev dependencies
COPY --chown=nextjs:nodejs package*.json ./
RUN npm ci --include=dev --silent && npm cache clean --force
# Copy source code
COPY --chown=nextjs:nodejs . .
EXPOSE 5173
# Healthcheck for dev
HEALTHCHECK --interval=30s --timeout=3s --start-period=10s --retries=2 CMD wget -q --spider http://localhost:5173/ || exit 1
# Use dumb-init for proper signal handling
ENTRYPOINT ["dumb-init", "--"]
# Start Vite dev server
CMD ["npm", "run", "dev"]
